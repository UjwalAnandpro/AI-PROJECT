name: Random Auto Star Bot

on:
  schedule:
    - cron: "0 5 * * *"   # Roz subah 5am UTC (10:30am IST)
  workflow_dispatch:

jobs:
  random-star:
    runs-on: ubuntu-latest

    steps:
      - name: Fetch trending repos
        id: fetch
        run: |
          curl -s https://ghapi.huchen.dev/repositories > trending.json
          echo "TRENDING=$(cat trending.json)" >> $GITHUB_ENV

      - name: Star 10 random repos
        run: |
          repos=($(echo "$TRENDING" | jq -r '.[].repo'))
          total=${#repos[@]}
          
          echo "Total trending repos: $total"
          
          for i in {1..10}; do
            r=$((RANDOM % total))
            repo=${repos[$r]}
            echo "Starring: $repo"

            curl -X PUT \
              -H "Accept: application/vnd.github+json" \
              -H "Authorization: Bearer ${GH_TOKEN}" \
              https://api.github.com/user/starred/$repo

            sleep $(( (RANDOM % 20) + 5 ))   # 5â€“25 sec random delay
          done
