name: Random Auto Star Bot

on:
  schedule:
    - cron: "0 5 * * *"
  workflow_dispatch:

jobs:
  random-star:
    runs-on: ubuntu-latest

    steps:
      - name: Install tools
        run: |
          sudo apt-get update
          sudo apt-get install -y jq htmlq

      - name: Download trending HTML
        run: |
          curl -s https://github.com/trending > trending.html

      - name: Parse trending repos
        id: parse
        run: |
          repos=$(htmlq 'article h2 a' -a href < trending.html | sed 's|^/||')
          echo "$repos" > repos.txt
          count=$(wc -l < repos.txt)
          echo "COUNT=$count" >> $GITHUB_ENV

      - name: Star random repos
        run: |
          if [ "$COUNT" -eq "0" ]; then
            echo "No repos found."
            exit 0
          fi

          for i in {1..10}; do
            repo=$(shuf -n 1 repos.txt)
            echo "Starring: $repo"

            curl -X PUT \
              -H "Accept: application/vnd.github+json" \
              -H "Authorization: Bearer ${{ secrets.GH_TOKEN }}" \
              https://api.github.com/user/starred/$repo

            sleep $(( (RANDOM % 10) + 2 ))
          done
